{% extends "base.html" %} 
{% import "bootstrap/wtf.html" as wtf %} 
{% block title %}Vertica{% endblock %} 

{% block page_content %}
<div class="page-header">
    <h1>Hello, 
        {% if current_user.is_authenticated %}{{ current_user.username }}
        {% else %}Stranger{% endif %}!</h1>
</div>
<div>
    {% if current_user.is_administrator() %}
    <div class="row">
       
        <div class="col-sm">
            <h4 style="color: darkgrey;">Solution</h4>
            <select class="form-select" name="ctg_name" id="ctg_name" onchange="fn(this.value,'step')">
                <option value="">Choose</option>
                <option value="Redis">Redis</option>
                <option value="ElasticSearch">ElasticSearch</option>
                
            </select>
        </div>
        <div class="col-sm">
            <h4 style="color:darkgrey;display:none" id="cluster" >Cluster</h4>
            <select class="form-select" name="step" id="step" style="display: none;" onchange="fn(this.value,'step2')">
                
                <option value="">choose</option>
            </select>
        </div>
    </div>
    
   
    <div class="row">
    <div class="col-sm" id="step2" stype="display:none">
    </div>
    <div class="col-sm" id="step3" stype="display:none"></div> <!-- Possible execution for the cluster -->
    </div>

        <!-- <ul class="list-unstyled row" id="step2" style="display:none">
             <form id="step2" style="display:none;">
            
            </form> 
                
        </ul> -->
            

   
    {% endif %}

</div>

{% endblock %}

{% block scripts %}{{ super() }}

<script>
    var clustername

    function fn(sParam,next){
        var $target = $("#"+next);
        $target.empty();
        if (sParam==""){
            //$target.append("<option value=''>choose</option>");
            $target.hide()
            $("#step2").hide()
            $("#cluster").hide()
            return;
        }

        if (next =="step"){
            $("#cluster").show()
        }else if(next=="step2"){
            $target.append('<br><br><h4 style="color:darkgrey;">Nodes</h4>')
        }
        console.log(sParam,next)
    
        $.ajax({
            type: "POST",
            url : "/practice",
            headers: {'Content-Type': 'application/json'},
            data: JSON.stringify({req_client: sParam}), //value you pass to the server
            dataType: "json",
            success: function(response){
                console.log(response);
                if (sParam == ""){
                }
                
                if ([response["result"]]){
                    if (next == "step2"){
                        clustername=$("#step").val()
                        for (let i = 0; i < response["result"].length; i++) {
                            let res = response["result"][i]  
                          
                            $target.append("<label class='form-check-label' style='color: grey'><input class='form-check-input' type='checkbox' name='nodes' value="+res+" checked>"+res+"</label><br>")
                            //$target.append(" <label class='form-check-label' style='color: darkgrey;' for="+res+"> "+res+"</label></td></tr>")
                            }
                        
                        $target.append("<br><br><button class='btn btn-primary' type='button' id='unique' style='display: none' onclick='postreq()'>Go</button>") //submit button
                    }  
                    else {
                    $("#step2").hide()
                    $target.append("<option value=''>choose</option>");
                    for (let i = 0; i < response["result"].length; i++) {
                        $target.append("<option value='" +response["result"][i] +"'>"+ response["result"][i] +"</option>")
                      }
                    }

                    $target.show()
                }

                if (response["type"] === "nodes"){
                    $("#unique").show()
        
                    $("#table").show()
               
                }

            }
        })

    };

    function postreq(){
        let nodes=[]
        var checkboxes = document.getElementsByName('nodes');
        for (var checkbox of checkboxes)
            {
                if (checkbox.checked) {
                    nodes.push(checkbox.value);
                }
            }
        console.log(clustername, nodes)

    }

</script>


{% endblock %}